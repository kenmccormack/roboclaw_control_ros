<launch>
    <!-- machines file -->
    <include file="$(find tobor)/launch/machines.launch"/>

    <arg name="use_motors" default="true"/>
    <arg name="use_cameras" default="true"/>
    <arg name="use_imu" default="true"/>
    <arg name="use_rtkrover" default="true"/>

    <!-- Motor controller -->
    <group if="$(arg use_motors)">
        <include file="$(find roboclaw_node)/launch/roboclaw.launch">
                <arg name="dev" value="/dev/ttyUSB0" />
                <arg name="baud" value="115200" />
                <arg name="ticks_per_meter" value="4488"/>
                <arg name="base_width" value="0.71"/>
                <arg name="max_abs_linear_speed" value="1.5"/>
        </include>

        <node name="teleop_convert"
              pkg="tobor"
              type="teleop_node"
	      args="_scale_linear:=4.0 _scale_angular:=1.0"
	      output= "screen">
        </node>
    </group>

    <!-- Usb webcam -->
    <!--
    <group if="$(arg use_cameras)">
        <include file="$(find tobor)/launch/webcam.launch" >
        </include>
    </group>
    -->

    <group if="$(arg use_rtkrover)">
    <!-- IMU and Compass -->
    <group if="$(arg use_imu)">
        <node name="imu_reader"
            pkg= "rtimu_reader"
            type= "rtimu_node"
            machine = "rtkrover" >
        </node>
    </group>

    <!-- GPS -->
    <node name = "rtk_reader"
          pkg = "rtkrover"
          type = "rtkrover_node" 
          machine = "rtkrover" 
	  output = "screen" >
    </node>

    <node 
        pkg="tobor" 
        type="rtk_odom" 
        name="gps_odom">
    </node>

    </group>

    <!-- Odometry -->
    <!-- this will merge the imu, wheel, gps odometry into one -->
    <node pkg="robot_pose_ekf" type="robot_pose_ekf" name="robot_pose_ekf">
        <param name="output_frame" value="odom"/>
        <param name="freq" value="10.0"/>
        <param name="sensor_timeout" value="1.0"/>
        <param name="odom_used" value="true"/>
        <param name="imu_used" value="false"/>
        <param name="vo_used" value="true"/>
        <param name="debug" value="true"/>
        <param name="self_diagnose" value="true"/>
           <remap from="vo" to="gps_odom" />
           <remap from="odom" to="odom_wheeled" />
           <remap from="robot_pose_ekf/odom_combined" to="odom"/>
    </node>



</launch>
